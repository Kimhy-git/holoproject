<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.mapper">


	<!-- test -->
	<select id="selectMember" resultType="dto">
        select * from user;
    </select>
    
    <!-- help_me 게시글 리스트 -->
	<select id="list" resultType="dto_p">
		select * from help_post, user where help_post.user_user_id=user.user_id and board=1 order by help_post_id desc;
	</select>
	
	<!-- help_me likes -->
	<select id="likes" resultType="dto_p">
		select user.nick, user.likes from help_post, user where user.user_id = help_post.user_user_id;
	</select>
	
	<!-- help_me 게시글 상세보기 -->
	<select id="read" resultType="dto_p">
		
		select * from help_post, user where user.user_id = help_post.user_user_id and help_post.help_post_id = #{help_post_id};
	</select>
	
	<!-- help_me 게시글 쓰기 -->
	<select id="write" parameterType="dto_p">
		insert into help_post (tag_area,img, board, title, nick, tag_job, content, gender, min_price, payment, complete, user_user_id) 
		values(#{tag_area},#{img},1,#{title},(select nick from user where user_id='b'),#{tag_job},#{content},#{gender},#{min_price},#{payment},0,"b")
	</select>
	<!-- help_me 게시글 수정 -->
	<select id="edit" resultType="dto_p">
		update help_post set title=#{title}, tag_area=#{tag_area}, tag_job=#{tag_job},
		content=#{content}, gender=#{gender}, min_price=#{min_price}, payment=#{payment}
 		where board=1 and help_post_id=#{help_post_id};
	</select>
	<!-- help_me 게시글 삭제 -->
	<select id="delete" resultType="dto_p">
		delete from help_post where help_post_id=#{help_post_id} 
	</select>
	<!-- help_me 게시글, 댓글 삭제 -->
	<select id='delete_re' resultType="dto_p">
		delete from help_reply where help_post_post_id=#{help_post_id} 
	</select>
		
	<!-- help_me댓글 보기 -->
	<select id="re_list" resultType="dto_pr">
	 	select * from help_reply, user where user.user_id = help_reply.user_user_id and help_post_post_id=#{help_post_id};
	</select>
	<!-- help_me댓글 작성 -->
	<select id="re_write"  resultType="dto_pr" parameterType="dto_pr">
		insert into help_reply (board,re_index, re_comment, re_order, groupNum, help_post_post_id, 
		user_user_id) values(1,1,#{re_comment},1,1,#{help_post_post_id},'a') ;
	</select>
	<!-- help_me댓글 수정 -->
	<select id="re_edit" resultType="dto_pr">
		update help_reply set re_comment=#{re_comment} where help_reply_id=#{help_reply_id}; 
	</select>
	<!-- help_me댓글 삭제 -->
	<select id="re_delete" resultType="dto_pr">
		delete from help_reply where help_reply_id=#{help_reply_id} 
	</select>
	<!-- help_me 수정 댓글 보기 -->
	<select id="re_edit_view" resultType="dto_pr">
		select * from help_reply where help_reply_id=#{help_reply_id}
	</select>
	
	<!-- help_me hit -->
	<select id="hit" resultType="dto_p">
		update help_post set hit = hit+1 where help_post_id=#{help_post_id}
	</select>
	
	
	<!-- help_you -->
	<select id="helpyou_list" resultType="dto_p">
		select help_post_id,tag_area,board,title,help_post.operator,help_post.nick,tag_job,content,img,help_post.gender,min_price,payment,complete,user_user_id,likes from help_post,user where user.user_id=help_post.user_user_id and board=0 order by help_post_id desc;
	</select>
	<!-- helpyou_write -->
	<insert id="helpyou_submit" parameterType="dto_p">
		insert into help_post(tag_area, board, title, nick, tag_job, content, img, gender, min_price, payment, complete, user_user_id)
		 values(#{tag_area},0,#{title},(select nick from user where user_id='a'),#{tag_job},#{content},#{img},#{gender},#{min_price},#{payment},0,'a');
	</insert>
	<!-- helpyou_write_view -->
	<select id="helpyou_write_view" parameterType="int" resultType="dto_p">
		select * from help_post where help_post_id=#{help_post_id}
	</select>
	<!-- helpyou write delete -->
	<delete id="helpyou_delete" parameterType="int">
		delete from help_post where help_post_id=#{help_post_id}
	</delete>
	<!-- helpyou edit update -->
	<update id="helpyou_edit">
		update help_post set 
		 tag_area=#{tag_area}, title=#{title}, tag_job=#{tag_job}, content=#{content}, img=#{img}, gender=#{gender}, min_price=#{min_price}, payment=#{payment}
		 where help_post_id=#{help_post_id}
	</update>
	<!-- helpyou postre delete -->
	<delete id="helpyou_repost_delete" parameterType="int">
		delete from help_reply where help_post_post_id=#{help_post_id}
	</delete>
	<!-- helpyou_reply_done -->
	<insert id="helpyou_reply_submit">
		insert into help_reply(board,re_comment, re_order, groupNum, help_post_post_id, user_user_id)
		 values(0, #{re_comment}, 0, 0, #{help_post_post_id}, #{user_user_id})
	</insert>
	<!-- helpyou_reply_list --> 
	<select id="helpyou_reply_list" parameterType="int" resultType="dto_pr">
		SELECT *
		FROM help_reply
		where board=0 and help_post_post_id=#{help_post_post_id}
		ORDER BY IF(re_index=0
		, help_reply_id, re_index), groupNum;
	</select>
	<!-- helpyou reply del -->
	<delete id="helpyou_reply_delete" parameterType="int">
		delete from help_reply where help_reply_id=#{help_post_post_id}
	</delete>
	<!-- helpyou reply update -->
	<update id="helpyou_reply_edit">
		update help_reply set
		 re_comment=#{re_comment}
		 where help_reply_id=#{help_reply_id}
	</update>
	<!-- helpyou re_recommnet submit -->
	<select id="helpyou_groupNum_select" resultType="int">
		select count(a.re_index) from help_reply as a,help_reply as b where a.re_index=b.help_reply_id and b.help_reply_id=#{re_index};
	</select>
	<insert id="helpyou_re_recommnet_submit" parameterType="dto_pr">
		insert into help_reply(board,re_index,re_comment, re_order, groupNum, help_post_post_id, user_user_id)
		 values(0, #{re_index}, #{re_comment}, #{re_order}, #{groupNum}, #{help_post_post_id}, #{user_user_id})
	</insert>



	<!-- notice -->

    <select id="select_post" resultType="dto_post"> 
    	select * from post where board=0; 
    </select>
    
     <!-- notice_write : add posts -->
    <select id="add_post" parameterType="dto_post"> 
    	insert into post(board, title, nick, content, img, user_user_id)
		values(0,#{title},'One',#{content},#{img},'a');
    </select>
    
    <!-- notice_write_view : add comments --> 
    <select id="add_comment" parameterType="dto_reply"> 
    	insert into reply(board,re_comment,post_post_id,user_user_id)
		values(0,#{re_comment},#{post_post_id},'a');	
    </select>
    
 	<!-- notice_write_view : add re_comments -->
    <select id="add_re_comment" parameterType="dto_reply"> 
       insert into reply(board,re_index,re_comment,re_order,groupNum,post_post_id,user_user_id)
      values(0,last_insert_id()+1,#{re_comment},#{re_order},#{groupNum},#{post_post_id},'a');   
    </select>
    
    <!-- notice_write_view -->
    <select id="select_post_view" resultType="dto_post"> 
    	select * from post where board=0 and post_id=#{post_id}; 
    </select>
    
    <!-- notice_write_view -->
    <select id="uphit" resultType="dto_post"> 
    	update post set hit = hit +1 where post_id=#{post_id};
    </select>
    
    <!-- notice_write_view : comment -->
    <select id="select_post_reply" resultType="dto_reply"> 
    	select * from reply where board=0 and post_post_id=#{post_id}
    	order by groupNum
    </select>
    
    <!-- notice_write_view : delete posts -->
    <select id="select_post_delete" resultType="dto_post"> 
    	delete from post where post_id=#{post_id} and board=0;
    </select>
    
    <!-- notice_write_view : delete comments with a post -->
    <select id="select_reply_delete" resultType="dto_reply"> 
    	delete from reply where post_post_id=#{post_post_id} and board=0;
    </select>
    
     <!-- notice_write_view : delete comments ONLY -->
    <select id="delete_comment" resultType="dto_reply"> 
    	delete from reply where reply_id=#{reply_id} and board=#{board} and
    	post_post_id=#{post_post_id};
    </select>
    
    <!-- update comments -->
    <select id="update_comment" resultType="dto_reply"> 
    	update reply set re_comment=#{re_comment}
    	where board=0 and reply_id=#{reply_id} and post_post_id=#{post_post_id};
    </select>
    
    
    <!-- log in -->
    <select id="login" resultType="String">
    	select nick from user 
    	where user_id=#{user_id} and user_pw=#{user_pw}
    </select>
    
    <select id="viewMember" resultType="dto_user">
    	select user_id, email, nick from user
    	where user_id=#{user_id} and user_pw=#{user_pw}
    </select>
    
    
    
  

    
    
    <!-- freeboard -->
    <select id="select_freeboard" resultType="dto_freeboard">
        select * from post where board=1;
    </select>
    <!-- 리스트 보기 -->
    
    <select id="select_freeboard_view" resultType="dto_freeboard">
        select * from post where board=1 and post_id=#{post_id};
    </select>
    <!-- 게시글 보기 -->
        <select id="free_uphit" resultType="dto_freeboard"> 
    	update post set hit = hit +1 where post_id=#{post_id};
    </select>
    <!-- 조회수 +1 -->
    
    <select id="select_freeboard_delete" resultType="dto_freeboard"> 
    	delete from post where post_id=#{post_id} and board=1;
    </select>
    <!-- 게시글 삭제 -->
 	
 	<select id="select_free_reply_delete" resultType="dto_free_reply_delete"> 
    	delete from reply where post_post_id=#{post_post_id} and board=1;
    </select>
    <!-- 게시글+댓글 삭제 -->
    <select id="freeboard_update" resultType="dto_freeboard"> 
    	update post set title=#{title}, content=#{content}
    	where post_id=#{post_id} and board=1;
    </select>
    <!-- 게시물 수정 -->
 
    <insert id="freeboard_write" parameterType="dto_freeboard">
    	insert into post(board, title, nick, content, img, user_user_id) 
    		values (1, #{title}, "se", #{content}, #{img}, "b");
    </insert>
	<!-- 게시물 등록 -->	
    
    <select id="add_free_comment" parameterType="dto_free_reply"> 
    	insert into reply(board,re_index,re_comment,post_post_id,user_user_id)
		values(1,0,#{re_comment},#{post_post_id},'a');	
    </select>
    <!-- 댓글 쓰기 -->   
    
    <select id="select_free_reply" resultType="dto_free_reply"> 
    	select * from reply where board=1 and post_post_id=#{post_id}
    	order by re_index, reply_id; 
    </select>
    <!-- 댓글 보여주기 -->
    
    <select id="delete_free_comment" resultType="dto_free_reply"> 
    	delete from reply where reply_id=#{reply_id} and board=#{board} and
    	post_post_id=#{post_post_id};
    </select>
    <!-- 댓글 삭제 -->
    
    <select id="update_free_comment_now" resultType="dto_free_reply" parameterType="com.javalec.holo.dto.Dto_free_reply"> 
    	update reply set re_comment=#{re_comment}
    	where board=1 and reply_id=#{reply_id} and post_post_id=#{post_post_id};
    </select>
    <!-- 댓글 수정 -->
    
    <select id="add_free_re_comment" parameterType="dto_free_reply"> 
    	     insert into reply(board,re_index,re_comment,re_order,groupNum,post_post_id,user_user_id)
      values(1,last_insert_id()+1,#{re_comment},#{re_order},#{groupNum},#{post_post_id},'a');	
    </select>
    <!-- 대댓글 추가 -->
    
    <select id="checkQueestionPw" parameterType="dto_user" resultType="int"> 
    	    select count(*)
    	    from user 
    	    where user_id = #{user_id} 
    	    and passwd_q = #{passwd_q}
    	    and passwd_a = #{passwd_a}	
    </select>
    <!-- 대댓글 추가 -->
    
    <select id="checkQueestionPw2" parameterType="com.javalec.holo.dto.Dto_user" resultType="int"> 
    	    select count(*)
    	    from user 
    	    where user_id = #{user_id} 
    	    and passwd_q = #{passwd_q}
    	    and passwd_a = #{passwd_a}	
    </select>
    <!-- 비밀번호 체크 -->
    
     <select id="getUserByUserId" parameterType="string" resultType="com.javalec.holo.dto.Dto_user"> 
    	    select user_id, user_pw, email, mobile, birth
    	    from user 
    	    where user_id = #{user_id} 	
    </select>
    <!-- 비밀번호 체크 -->
    

</mapper>